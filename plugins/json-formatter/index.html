<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>JSON 格式化</title>
  <style>
    :root{ --bg:#ffffff; --fg:#333; --panel:#ffffff; --border:#e5e7eb; --muted:#888; --accent:#007AFF; --scrollbar-thumb: rgba(0,0,0,0.2); --scrollbar-track: transparent; }
    body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; margin: 0; display: flex; height: 100vh; background: var(--bg); color: var(--fg); }
    .layout { display: grid; grid-template-rows: 44px 1fr 44px; grid-template-columns: 1fr 1fr; grid-template-areas: 'toolbar toolbar' 'left right' 'query query'; width: 100%; }
    .toolbar { grid-area: toolbar; padding: 8px 10px; border-bottom: 1px solid var(--border); display: flex; gap: 8px; align-items:center; background: var(--panel); }
    .btn { padding: 6px 12px; font-size: 13px; border: 1px solid var(--border); border-radius: 6px; background: var(--panel); color: var(--fg); cursor: pointer; }
    .btn:hover { background: rgba(0,0,0,0.06); }
    .input { padding: 6px 10px; border: 1px solid var(--border); border-radius: 6px; background: var(--panel); color: var(--fg); font-size: 13px; }
    .select { padding: 6px 8px; border: 1px solid var(--border); border-radius: 6px; background: var(--panel); color: var(--fg); font-size: 13px; }
    .pane { border-right: 1px solid var(--border); }
    .left { grid-area: left; display:flex; flex-direction:column; }
    .right { grid-area: right; display:flex; flex-direction:column; }
    .title { display:none; }
    textarea { flex: 1; border: 1px solid var(--border); outline: none; padding: 10px; font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace; font-size: 13px; background: var(--panel); color: var(--fg); border-radius: 6px; }
    .error { color: #ef4444; padding: 8px 10px; border-top: 1px solid var(--border); background: rgba(239,68,68,0.08); font-size: 12px; display: none; }
    .query { grid-area: query; border-top: 1px solid var(--border); display:flex; align-items:center; gap:8px; padding: 6px 10px; background: var(--panel); }
    .query input { flex:1; padding:8px 10px; border:1px solid var(--border); border-radius:6px; background: var(--panel); color: var(--fg); font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace; }
    .query-hint { font-size:12px; color: var(--muted); }

    /* 滚动条 */
    textarea::-webkit-scrollbar { width: 10px; height:10px; }
    textarea::-webkit-scrollbar-thumb { background: var(--scrollbar-thumb); border-radius:6px; }
    textarea::-webkit-scrollbar-track { background: var(--scrollbar-track); }
    #viewer::-webkit-scrollbar { width: 10px; height:10px; }
    #viewer::-webkit-scrollbar-thumb { background: var(--scrollbar-thumb); border-radius:6px; }
    #viewer::-webkit-scrollbar-track { background: var(--scrollbar-track); }
    body, #viewer, textarea { scrollbar-color: var(--scrollbar-thumb) var(--scrollbar-track); scrollbar-width: thin; }

    /* 输入聚焦时保持边框色，不展示黄色高亮 */
    .input:focus, .select:focus, .query input:focus, textarea:focus { outline: none; box-shadow: none; border-color: var(--border); }

    /* JSON 高亮 */
    .json-key { color: var(--muted); }
    .value-string { color: #10b981; }
    .value-number { color: #f59e0b; }
    .value-boolean { color: #8b5cf6; }
    .value-null { color: #9ca3af; }
    .match { background: rgba(0,122,255,0.18); border-radius: 4px; }
    .active-match { outline: 2px solid #007AFF; outline-offset: 2px; border-radius: 4px; }
  </style>
  <script>
    window.MTAPI = window.MT;
  </script>
  <script>
    (async function(){
      function applyTheme(effective){
        const root = document.documentElement;
        if (effective === 'dark'){
          root.style.setProperty('--bg', '#0f1113');
          root.style.setProperty('--panel', '#2b2d31');
          root.style.setProperty('--fg', '#e6e7ea');
          root.style.setProperty('--border', '#3a3b41');
          root.style.setProperty('--muted', '#a0a0a0');
          root.style.setProperty('--scrollbar-thumb', 'rgba(255,255,255,0.25)');
          root.style.setProperty('--scrollbar-track', 'rgba(255,255,255,0.06)');
        } else {
          root.style.setProperty('--bg', '#ffffff');
          root.style.setProperty('--panel', '#ffffff');
          root.style.setProperty('--fg', '#333333');
          root.style.setProperty('--border', '#e5e7eb');
          root.style.setProperty('--muted', '#666666');
          root.style.setProperty('--scrollbar-thumb', 'rgba(0,0,0,0.2)');
          root.style.setProperty('--scrollbar-track', 'transparent');
        }
      }
      try {
        const themeInfo = await window.MT.invoke('ui.getTheme');
        const eff = (themeInfo && themeInfo.effective) || 'light';
        applyTheme(eff);
      } catch {}
      window.addEventListener('mt-theme-change', (ev)=>{
        try { applyTheme((ev && ev.detail && ev.detail.effective) || 'light'); } catch {}
      });
    })();
  </script>
  <script defer src="script.js"></script>
</head>
<body>
  <div class="layout">
    <div class="toolbar">
      <button class="btn" id="btnFormat">格式化</button>
      <button class="btn" id="btnMinify">压缩</button>
      <button class="btn" id="btnCopy">复制结果</button>
      <span style="flex:0 0 12px"></span>
      <input class="input" id="search" placeholder="搜索键/值" style="min-width: 180px;">
      <button class="btn" id="btnPrev">上一个</button>
      <button class="btn" id="btnNext">下一个</button>
      <span style="flex:0 0 12px"></span>
      <label style="font-size:12px;color:var(--muted);">展开层级</label>
      <select class="select" id="expandLevel">
        <option value="0">0</option>
        <option value="1" selected>1</option>
        <option value="2">2</option>
        <option value="3">3</option>
        <option value="4">4</option>
        <option value="5">5</option>
      </select>
      <button class="btn" id="btnCollapseAll">折叠</button>
      <button class="btn" id="btnExpandAll">展开</button>
    </div>
    <div class="left pane">
      <textarea id="input" placeholder="粘贴 JSON 或主程序传入..."></textarea>
    </div>
    <div class="right">
      <div id="viewer" style="flex:1; overflow:auto; background: var(--panel); color: var(--fg);"></div>
      <div id="error" class="error"></div>
    </div>
    <div class="query">
      <div class="query-hint">查询 (JS 表达式，使用 this 作为数据根)</div>
      <input id="query" placeholder="例如：this.items.filter(x=>x.active).map(x=>x.name)">
    </div>
  </div>
</body>
</html>


