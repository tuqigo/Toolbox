<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>JSON Ê†ºÂºèÂåñ</title>
  <style>
    :root{ --bg:#ffffff; --fg:#333; --panel:#ffffff; --border:#e5e7eb; --muted:#888; --accent:#007AFF; --scrollbar-thumb: rgba(0,0,0,0.2); --scrollbar-track: transparent; }
    body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; margin: 0; display: flex; height: 100vh; background: var(--bg); color: var(--fg); }
    .layout { display: grid; grid-template-rows: 1fr 44px; grid-template-columns: 1fr; grid-template-areas: 'viewer' 'query'; width: 100%; height: 100vh; }
    .viewer-container { grid-area: viewer; display: flex; overflow: hidden; }
    .line-numbers { width: 60px; background: var(--panel); border-right: 1px solid var(--border); padding: 10px 5px; font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace; font-size: 13px; color: var(--muted); line-height: 20px; overflow: hidden; user-select: none; position: relative; }
    .line-number { display: flex; align-items: center; height: 20px; position: relative; }
    .line-num { flex: 1; text-align: right; padding-right: 4px; line-height: 20px; }
    .fold-arrow { width: 16px; height: 16px; cursor: pointer; color: var(--muted); font-size: 12px; display: flex; align-items: center; justify-content: center; border-radius: 3px; margin-left: 2px; line-height: 20px; }
    .fold-arrow:hover { background: rgba(0,0,0,0.1); color: var(--fg); }
    .fold-arrow.hidden { visibility: hidden; }
    .editor { flex: 1; border: none; outline: none; padding: 10px; font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace; font-size: 13px; background: var(--panel); color: var(--fg); line-height: 20px; resize: none; white-space: pre; overflow-wrap: normal; overflow-x: auto; overflow-y: auto; }
    .error { color: #ef4444; padding: 8px 10px; border-top: 1px solid var(--border); background: rgba(239,68,68,0.08); font-size: 12px; display: none; }
    .query { grid-area: query; position: sticky; bottom: 0; z-index: 10; border-top: 1px solid var(--border); display:flex; align-items:center; gap:8px; padding: 6px 10px; background: var(--panel); }
    .query input { flex:1; padding:8px 10px; border:1px solid var(--border); border-radius:6px; background: var(--panel); color: var(--fg); font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace; }
    .query-hint { font-size:12px; color: var(--muted); }
    .icon-btn { width: 32px; height: 32px; border: 1px solid var(--border); border-radius: 6px; background: var(--panel); color: var(--fg); cursor: pointer; display: flex; align-items: center; justify-content: center; font-size: 14px; transition: all 0.15s ease; position: relative; }
    .icon-btn:hover { background: var(--accent); color: #fff; border-color: var(--accent); }
    .tooltip { position: fixed; background: rgba(0,0,0,0.8); color: white; padding: 4px 8px; border-radius: 4px; font-size: 11px; white-space: nowrap; z-index: 1000; pointer-events: none; display: none; max-width: 200px; }
    
    /* Êü•ÊâæÊõøÊç¢ÁªÑ‰ª∂ */
    .search-widget { position: absolute; top: 10px; right: 20px; width: 320px; background: var(--panel); border: 1px solid var(--border); border-radius: 6px; box-shadow: 0 4px 12px rgba(0,0,0,0.15); z-index: 100; display: none; }
    .search-body { padding: 8px; }
    .search-row { display: flex; align-items: center; gap: 4px; margin-bottom: 6px; }
    .search-input { flex: 1; padding: 4px 8px; border: 1px solid var(--border); border-radius: 4px; background: var(--panel); color: var(--fg); font-size: 12px; font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace; }
    .search-input:focus { outline: none; border-color: var(--accent); }
    .search-btn { width: 24px; height: 24px; border: 1px solid var(--border); border-radius: 4px; background: var(--panel); color: var(--fg); cursor: pointer; display: flex; align-items: center; justify-content: center; font-size: 11px; }
    .search-btn:hover { background: var(--accent); color: white; border-color: var(--accent); }
    .search-btn:disabled { opacity: 0.5; cursor: not-allowed; }
    .search-btn.active { background: var(--accent); color: white; border-color: var(--accent); }
    .search-close { width: 24px; height: 24px; border: 1px solid var(--border); border-radius: 4px; background: var(--panel); color: var(--muted); cursor: pointer; display: flex; align-items: center; justify-content: center; font-size: 12px; }
    .search-close:hover { background: var(--accent); color: white; border-color: var(--accent); }
    .search-count { font-size: 11px; color: var(--muted); min-width: 60px; text-align: right; }
    .search-options { display: flex; gap: 2px; }
    .search-match { background: rgba(255, 193, 7, 0.3); border-radius: 2px; }
    .search-current-match { background: rgba(255, 193, 7, 0.6); border-radius: 2px; }

    /* ÊªöÂä®Êù° */
    ::-webkit-scrollbar { width: 10px; height:10px; }
    ::-webkit-scrollbar-thumb { background: var(--scrollbar-thumb); border-radius:6px; border: 2px solid transparent; background-clip: content-box; }
    ::-webkit-scrollbar-track { background: var(--scrollbar-track); }
    ::-webkit-scrollbar-thumb:hover { background: var(--scrollbar-thumb-hover); }
    body, #viewer, .line-numbers { scrollbar-color: var(--scrollbar-thumb) var(--scrollbar-track); scrollbar-width: thin; }

    /* ËæìÂÖ•ËÅöÁÑ¶Êó∂‰øùÊåÅËæπÊ°ÜËâ≤Ôºå‰∏çÂ±ïÁ§∫ÈªÑËâ≤È´ò‰∫Æ */
    .input:focus, .select:focus, .query input:focus, textarea:focus { outline: none; box-shadow: none; border-color: var(--border); }

    /* JSON È´ò‰∫Æ */
    .json-key { color: var(--muted); }
    .value-string { color: #10b981; }
    .value-number { color: #f59e0b; }
    .value-boolean { color: #8b5cf6; }
    .value-null { color: #9ca3af; }
    .match { background: rgba(0,122,255,0.18); border-radius: 4px; }
    .active-match { outline: 2px solid #007AFF; outline-offset: 2px; border-radius: 4px; }
  </style>
  <script>
    window.MTAPI = window.MT;
  </script>
  <script>
    (async function(){
      function applyTheme(effective){
        const root = document.documentElement;
        if (effective === 'dark'){
          root.style.setProperty('--bg', '#0f1113');
          root.style.setProperty('--panel', '#2b2d31');
          root.style.setProperty('--fg', '#e6e7ea');
          root.style.setProperty('--border', '#3a3b41');
          root.style.setProperty('--muted', '#a0a0a0');
          root.style.setProperty('--scrollbar-thumb', 'rgba(255,255,255,0.25)');
          root.style.setProperty('--scrollbar-track', 'rgba(255,255,255,0.06)');
          root.style.setProperty('--scrollbar-thumb-hover', 'rgba(255,255,255,0.4)');
        } else {
          root.style.setProperty('--bg', '#ffffff');
          root.style.setProperty('--panel', '#ffffff');
          root.style.setProperty('--fg', '#333333');
          root.style.setProperty('--border', '#e5e7eb');
          root.style.setProperty('--muted', '#666666');
          root.style.setProperty('--scrollbar-thumb', 'rgba(0,0,0,0.2)');
          root.style.setProperty('--scrollbar-track', 'transparent');
          root.style.setProperty('--scrollbar-thumb-hover', 'rgba(0,0,0,0.35)');
        }
      }
      try {
        const themeInfo = await window.MT.invoke('ui.getTheme');
        const eff = (themeInfo && themeInfo.effective) || 'light';
        applyTheme(eff);
      } catch {}
      window.addEventListener('mt-theme-change', (ev)=>{
        try { applyTheme((ev && ev.detail && ev.detail.effective) || 'light'); } catch {}
      });
    })();
  </script>
  <script defer src="script.js"></script>
</head>
<body>
  <div class="layout">
    <div class="viewer-container" style="position: relative;">
      <div class="line-numbers" id="lineNumbers"></div>
      <textarea class="editor" id="editor" placeholder="Á≤òË¥¥ JSON Êï∞ÊçÆÊàñÁ≠âÂæÖ‰∏ªÁ®ãÂ∫è‰º†ÂÖ•Êï∞ÊçÆ..." spellcheck="false" autocorrect="off" autocomplete="off" autocapitalize="off"></textarea>
      
      <!-- Êü•ÊâæÊõøÊç¢ÁªÑ‰ª∂ -->
      <div class="search-widget" id="searchWidget">
        <div class="search-body">
          <div class="search-row">
            <input class="search-input" id="searchInput" placeholder="Êü•Êâæ" autocomplete="off">
            <div class="search-options">
              <!-- <div class="search-count" id="searchCount">0/0</div> -->
              <button class="search-btn" id="caseSensitive" title="Âå∫ÂàÜÂ§ßÂ∞èÂÜô">Aa</button>
              <button class="search-btn" id="searchPrev" title="‰∏ä‰∏Ä‰∏™">‚Üë</button>
              <button class="search-btn" id="searchNext" title="‰∏ã‰∏Ä‰∏™">‚Üì</button>
              <button class="search-close" id="searchClose" title="ÂÖ≥Èó≠">‚úï</button>
            </div>
          </div>
          <div class="search-row">
            <input class="search-input" id="replaceInput" placeholder="ÊõøÊç¢" autocomplete="off">
            <div class="search-options">
              <button class="search-btn" id="replaceOne" title="ÊõøÊç¢">‚Üí</button>
              <button class="search-btn" id="replaceAll" title="ÂÖ®ÈÉ®ÊõøÊç¢">‚áí</button>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div id="error" class="error"></div>
    <div class="query">
      <div class="query-hint">this.</div>
      <input id="query" placeholder="‰æãÂ¶ÇÔºöthis.items.filter(x=>x.active).map(x=>x.name)">
      <button class="icon-btn" id="btnFormat" title="ÈáçÊñ∞Ê†ºÂºèÂåñ">{ }</button>
      <button class="icon-btn" id="btnCollapseAll" title="ÊäòÂè†ÂÖ®ÈÉ®">‚ûñ</button>
      <button class="icon-btn" id="btnExpandAll" title="Â±ïÂºÄÂÖ®ÈÉ®">‚ûï</button>
      <button class="icon-btn" id="btnCopyMinify" title="ÂéãÁº©jsonÂπ∂Â§çÂà∂">üìã</button>
    </div>
  </div>
  <div class="tooltip" id="tooltip"></div>
</body>
</html>