# Phase 3: å›¾ç‰‡èƒ¶å›Šå’Œå“åº”å¼è®¾è®¡ç³»ç»Ÿå®ç°æ€»ç»“

## ğŸ“‹ æ¦‚è¿°

æœ¬æ¬¡å¼€å‘å®Œæˆäº† Phase 3: å›¾ç‰‡èƒ¶å›Šå’Œç¼©ç•¥å›¾ç”ŸæˆåŠŸèƒ½ï¼ŒåŒæ—¶é‡æ„äº†æ•´ä¸ªUIçš„å“åº”å¼è®¾è®¡ç³»ç»Ÿï¼Œå®ç°äº†ä»ç¡¬ç¼–ç åƒç´ å€¼åˆ°å®Œå…¨åŠ¨æ€è®¡ç®—çš„è½¬å˜ã€‚

## ğŸ¯ ä¸»è¦å®ŒæˆåŠŸèƒ½

### 1. å›¾ç‰‡èƒ¶å›Šç³»ç»Ÿ

#### 1.1 å›¾ç‰‡æ–‡ä»¶æ£€æµ‹
- **æ”¯æŒæ ¼å¼**: `jpg`, `jpeg`, `png`, `gif`, `webp`, `bmp`, `svg`
- **æ£€æµ‹é€»è¾‘**: æ‰©å±• `isImageFile()` æ–¹æ³•ï¼ŒåŸºäºæ–‡ä»¶æ‰©å±•ååˆ¤æ–­
- **é›†æˆä½ç½®**: `createCapsule()` æ–¹æ³•ä¸­çš„æ™ºèƒ½ç±»å‹é€‰æ‹©

#### 1.2 å‰ªè´´æ¿å›¾ç‰‡å¤„ç†
- **ä¸»è¿›ç¨‹æ£€æµ‹**: ä½¿ç”¨ `clipboard.readImage()` æ£€æµ‹å‰ªè´´æ¿å›¾ç‰‡æ•°æ®
- **æ•°æ®ä¼ é€’**: é€šè¿‡ç‰¹æ®Šæ ‡è¯† `[CLIPBOARD-IMAGE]${dataUrl}` ä¼ é€’
- **ä¼˜å…ˆçº§**: å›¾ç‰‡æ•°æ®ä¼˜å…ˆçº§é«˜äºæ–‡ä»¶è·¯å¾„ï¼Œé¿å…å†²çª

#### 1.3 ç¼©ç•¥å›¾ç”Ÿæˆç³»ç»Ÿ
- **æŠ€æœ¯æ–¹æ¡ˆ**: HTML5 Canvas API å¿«é€Ÿç”Ÿæˆç¼©ç•¥å›¾
- **å°ºå¯¸ç­–ç•¥**: æ­£æ–¹å½¢ç¼©ç•¥å›¾ï¼Œä¿æŒå®½é«˜æ¯”ï¼Œå±…ä¸­è£å‰ª
- **å‹ç¼©è´¨é‡**: JPEG æ ¼å¼ï¼Œ0.8 å‹ç¼©è´¨é‡
- **ç»Ÿä¸€æ¥å£**: `generateThumbnailFromSrc()` é€šç”¨æ–¹æ³•ï¼Œæ¶ˆé™¤é‡å¤ä»£ç 

#### 1.4 æ€§èƒ½ä¼˜åŒ–å’Œé”™è¯¯å¤„ç†
- **å¤§å°é™åˆ¶**: å¯é…ç½®çš„å›¾ç‰‡å¤§å°é™åˆ¶ï¼ˆé»˜è®¤2MBï¼‰
- **è¶…æ—¶æœºåˆ¶**: 5ç§’å›¾ç‰‡åŠ è½½è¶…æ—¶
- **é”™è¯¯é™çº§**: å¤±è´¥æ—¶é™çº§åˆ°æ–‡ä»¶èƒ¶å›Šæˆ–æ–‡æœ¬èƒ¶å›Š
- **è¯¦ç»†æ—¥å¿—**: å®Œæ•´çš„é”™è¯¯æ—¥å¿—è®°å½•ç³»ç»Ÿ

#### 1.5 å¼‚æ­¥åŠ è½½å’Œéª¨æ¶å±
- **ç«‹å³å“åº”**: ç«‹å³è¿”å›loadingçŠ¶æ€èƒ¶å›Š
- **éª¨æ¶å±åŠ¨ç”»**: CSSåŠ¨ç”»éª¨æ¶å±ï¼Œæ”¯æŒæ˜æš—ä¸»é¢˜
- **å¼‚æ­¥å¤„ç†**: åå°å¼‚æ­¥ç”Ÿæˆç¼©ç•¥å›¾ï¼Œå®Œæˆåæ›´æ–°UI
- **çŠ¶æ€ç®¡ç†**: å®Œæ•´çš„loadingã€successã€errorçŠ¶æ€ç®¡ç†

### 2. å“åº”å¼è®¾è®¡ç³»ç»Ÿé‡æ„

#### 2.1 å±‚çº§é…ç½®æ¶æ„
```
å±å¹•å°ºå¯¸ â†’ çª—å£å°ºå¯¸ â†’ è¾“å…¥æ¡†å°ºå¯¸ â†’ èƒ¶å›Šå°ºå¯¸ â†’ ç¼©ç•¥å›¾å°ºå¯¸
```

#### 2.2 é…ç½®å‚æ•°ç»“æ„
```javascript
responsive: {
  // æœ€å¤§å›¾ç‰‡å¤§å°é™åˆ¶(MB)
  maxImageSizeMB: 2,
  
  // çª—å£å°ºå¯¸æ¯”ä¾‹é…ç½®ï¼ˆç›¸å¯¹äºå±å¹•å·¥ä½œåŒºï¼‰
  windowSizeRatio: {
    small: { width: 0.45, height: 0.35 },    // å°å±å¹• (<1366px)
    medium: { width: 0.4, height: 0.3 },     // ä¸­ç­‰å±å¹• (1366-1920px)  
    large: { width: 0.35, height: 0.25 }     // å¤§å±å¹• (>1920px)
  },
  
  // æœ€å°/æœ€å¤§çª—å£å°ºå¯¸é™åˆ¶
  windowSizeLimit: {
    minWidth: 600, maxWidth: 1200,
    minHeight: 400, maxHeight: 800
  },
  
  // æ’ä»¶åˆ—è¡¨ç›¸å¯¹äºä¸»çª—å£çš„å®½åº¦æ¯”ä¾‹
  pluginListWidthRatio: 0.97,
  
  // è¾“å…¥æ¡†é«˜åº¦æ¯”ä¾‹ï¼ˆç›¸å¯¹äºçª—å£é«˜åº¦ï¼‰
  inputHeightRatio: 0.12,
  
  // èƒ¶å›Šå°ºå¯¸æ¯”ä¾‹ï¼ˆç›¸å¯¹äºè¾“å…¥æ¡†ï¼‰
  capsuleRatio: {
    height: 0.85,  // èƒ¶å›Šé«˜åº¦ = è¾“å…¥æ¡†é«˜åº¦ Ã— 85%
    maxWidth: 0.3  // èƒ¶å›Šæœ€å¤§å®½åº¦ = è¾“å…¥æ¡†å®½åº¦ Ã— 30%
  },
  
  // ç¼©ç•¥å›¾å°ºå¯¸æ¯”ä¾‹ï¼ˆç›¸å¯¹äºèƒ¶å›Šé«˜åº¦ï¼‰
  thumbnailRatio: 0.9
}
```

#### 2.3 å±å¹•æ£€æµ‹å’Œç¼“å­˜æœºåˆ¶
- **å¯åŠ¨æ£€æµ‹**: åº”ç”¨å¯åŠ¨æ—¶æ£€æµ‹ä¸€æ¬¡å±å¹•ä¿¡æ¯å¹¶ç¼“å­˜
- **å±å¹•åˆ†ç±»**: æ ¹æ®å®½åº¦è‡ªåŠ¨åˆ†ç±»ä¸º small/medium/large
- **å°ºå¯¸è®¡ç®—**: åŸºäºå±å¹•ç±»å‹å’Œé…ç½®æ¯”ä¾‹è®¡ç®—æ‰€æœ‰UIå°ºå¯¸
- **ç¼“å­˜ç­–ç•¥**: è®¡ç®—ç»“æœç¼“å­˜ï¼Œé¿å…é‡å¤è®¡ç®—

#### 2.4 CSSå˜é‡ç³»ç»Ÿ
```css
:root {
  --window-width: 700px;
  --window-height: 450px;
  --plugin-list-width: 680px;
  --input-height: 54px;
  --capsule-height: 46px;
  --thumbnail-size: 41px;
}
```

#### 2.5 åŠ¨æ€å°ºå¯¸è®¡ç®—å…¬å¼
```javascript
// å±‚çº§è®¡ç®—ï¼šçª—å£ â†’ è¾“å…¥æ¡† â†’ èƒ¶å›Š â†’ ç¼©ç•¥å›¾
const inputHeight = Math.floor(windowHeight * responsiveConfig.inputHeightRatio);
const capsuleHeight = Math.floor(inputHeight * responsiveConfig.capsuleRatio.height);
const thumbnailSize = Math.floor(capsuleHeight * responsiveConfig.thumbnailRatio);
```

### 3. ç¡¬ç¼–ç æ¸…ç†

#### 3.1 æ¸…ç†çš„ç¡¬ç¼–ç ä½ç½®
1. **ç³»ç»Ÿå›¾æ ‡å°ºå¯¸**: `16px` â†’ `ç¼©ç•¥å›¾å°ºå¯¸ Ã— 0.7`
2. **è¾“å…¥æ¡†æœ€å°é«˜åº¦**: `52px` â†’ `var(--input-height)`
3. **èƒ¶å›Šé«˜åº¦**: `36px` â†’ `var(--capsule-height)`
4. **èƒ¶å›Šå›¾æ ‡å°ºå¯¸**: `16px` â†’ `var(--thumbnail-size)`
5. **èƒ¶å›Šå›¾æ ‡å­—ä½“**: `14px` â†’ `calc(var(--thumbnail-size) * 0.5)`
6. **æ’ä»¶åˆ—è¡¨å›¾æ ‡**: `32px` â†’ `var(--thumbnail-size)`
7. **ç©ºçŠ¶æ€å›¾æ ‡**: `32px` â†’ `calc(var(--thumbnail-size) * 1.2)`
8. **ç»“æœåˆ—è¡¨é«˜åº¦**: `300px` â†’ `calc(var(--window-height) * 0.6)`
9. **ç¼–è¾‘å™¨é«˜åº¦**: `120px-300px` â†’ `çª—å£é«˜åº¦çš„25%-60%`

#### 3.2 CSSå˜é‡ä½¿ç”¨ç¤ºä¾‹
```css
.content-capsule {
  height: var(--capsule-height);
  max-height: var(--capsule-height);
}

.image-skeleton {
  width: var(--thumbnail-size);
  height: var(--thumbnail-size);
}

.result-icon {
  width: var(--thumbnail-size);
  height: var(--thumbnail-size);
  font-size: calc(var(--thumbnail-size) * 0.5);
}
```

## ğŸ—ï¸ æŠ€æœ¯å®ç°ç»†èŠ‚

### 1. ä¸»è¿›ç¨‹ (main.js)

#### å±å¹•æ£€æµ‹å’Œå°ºå¯¸è®¡ç®—
```javascript
detectScreenAndCalculateSizes() {
  const primaryDisplay = screen.getPrimaryDisplay();
  const { width: screenWidth, height: screenHeight } = primaryDisplay.workAreaSize;
  
  // ç¡®å®šå±å¹•ç±»å‹
  let screenType = 'medium';
  if (screenWidth < 1366) screenType = 'small';
  else if (screenWidth >= 1920) screenType = 'large';
  
  // å±‚çº§è®¡ç®—
  const inputHeight = Math.floor(windowHeight * responsiveConfig.inputHeightRatio);
  const capsuleHeight = Math.floor(inputHeight * responsiveConfig.capsuleRatio.height);
  const thumbnailSize = Math.floor(capsuleHeight * responsiveConfig.thumbnailRatio);
  
  // ç¼“å­˜ç»“æœ
  this.windowSizes = { windowWidth, windowHeight, pluginListWidth, inputHeight, capsuleHeight, thumbnailSize, maxImageSizeMB };
}
```

#### IPCå¤„ç†å™¨
```javascript
// è·å–å“åº”å¼å°ºå¯¸ä¿¡æ¯
ipcMain.handle('get-responsive-sizes', () => this.getWindowSizes());

// è·å–å±å¹•ä¿¡æ¯
ipcMain.handle('get-screen-info', () => this.getScreenInfo());

// è·å–æ–‡ä»¶ç»Ÿè®¡ä¿¡æ¯
ipcMain.handle('get-file-stats', async (event, filePath) => { /* ... */ });
```

### 2. æ¸²æŸ“è¿›ç¨‹ (renderer.js)

#### å›¾ç‰‡èƒ¶å›Šåˆ›å»º
```javascript
async createImageCapsule(filePath) {
  // ç«‹å³è¿”å›loadingçŠ¶æ€èƒ¶å›Š
  const loadingCapsule = {
    type: 'image', content: filePath, displayText: fileName,
    icon: null, iconType: 'loading', isLoading: true
  };
  
  // å¼‚æ­¥å¤„ç†å›¾ç‰‡åŠ è½½
  this.processImageAsync(filePath, loadingCapsule);
  return loadingCapsule;
}
```

#### ç¼©ç•¥å›¾ç”Ÿæˆä¼˜åŒ–
```javascript
// é€šç”¨ç¼©ç•¥å›¾ç”Ÿæˆæ–¹æ³•
async generateThumbnailFromSrc(imageSrc, logPrefix) {
  return new Promise((resolve) => {
    const img = new Image();
    const timeout = setTimeout(() => resolve(null), 5000);
    
    img.onload = () => {
      clearTimeout(timeout);
      const canvas = document.createElement('canvas');
      const size = this.getThumbnailSize(); // åŠ¨æ€å°ºå¯¸
      // ... canvaså¤„ç†é€»è¾‘
      resolve(canvas.toDataURL('image/jpeg', 0.8));
    };
    
    img.src = imageSrc;
  });
}
```

#### å“åº”å¼å°ºå¯¸ç®¡ç†
```javascript
async initResponsiveSizes() {
  this.responsiveSizes = await ipcRenderer.invoke('get-responsive-sizes');
  this.applyCSSVariables();
}

applyCSSVariables() {
  const root = document.documentElement;
  root.style.setProperty('--window-width', `${sizes.windowWidth}px`);
  root.style.setProperty('--capsule-height', `${sizes.capsuleHeight}px`);
  root.style.setProperty('--thumbnail-size', `${sizes.thumbnailSize}px`);
  // ...
}
```

### 3. æ ·å¼ç³»ç»Ÿ (style.css)

#### CSSå˜é‡å®šä¹‰
```css
:root {
  --window-width: 700px;
  --window-height: 450px;
  --plugin-list-width: 680px;
  --input-height: 54px;
  --capsule-height: 46px;
  --thumbnail-size: 41px;
}
```

#### å“åº”å¼ç»„ä»¶æ ·å¼
```css
.content-capsule {
  height: var(--capsule-height);
  max-height: var(--capsule-height);
  overflow: hidden;
}

.image-skeleton {
  width: var(--thumbnail-size);
  height: var(--thumbnail-size);
  animation: skeleton-loading 1.5s infinite;
}

.results-list {
  max-height: calc(var(--window-height) * 0.6);
}
```

## ğŸ› é—®é¢˜è§£å†³è®°å½•

### 1. èƒ¶å›Šæ’‘å¤§è¾“å…¥æ¡†é—®é¢˜
**é—®é¢˜**: è®¾ç½® `thumbnailSizeRatio: 0.8` å¯¼è‡´è¾“å…¥æ¡†è¢«æ’‘å¤§
**åŸå› **: èƒ¶å›Šé«˜åº¦ä½¿ç”¨ç™¾åˆ†æ¯” `height: 80%`ï¼Œå¤§ç¼©ç•¥å›¾æ’‘å¤§èƒ¶å›Š
**è§£å†³**: æ”¹ä¸ºå›ºå®šé«˜åº¦ `height: var(--capsule-height)`ï¼ŒåŸºäºè¾“å…¥æ¡†åŠ¨æ€è®¡ç®—

### 2. é…ç½®åŠ è½½æ—¶åºé—®é¢˜  
**é—®é¢˜**: å±å¹•æ£€æµ‹åœ¨é…ç½®åŠ è½½å‰æ‰§è¡Œï¼Œå¯¼è‡´ `Cannot read properties of undefined (reading 'split')` é”™è¯¯
**è§£å†³**: è°ƒæ•´å¯åŠ¨é¡ºåºï¼Œé…ç½®åŠ è½½å®Œæˆåå†æ‰§è¡Œå±å¹•æ£€æµ‹

### 3. æ—¥å¿—æ˜¾ç¤ºé—®é¢˜
**é—®é¢˜**: `console.log` æ‰“å°å¯¹è±¡æ˜¾ç¤º `[object Object]`
**è§£å†³**: ä½¿ç”¨ `JSON.stringify(obj, null, 2)` æ ¼å¼åŒ–è¾“å‡º

### 4. ç¡¬ç¼–ç å°ºå¯¸æ¸…ç†
**é—®é¢˜**: å¤šå¤„ç¡¬ç¼–ç åƒç´ å€¼å½±å“å“åº”å¼æ•ˆæœ
**è§£å†³**: ç³»ç»Ÿæ€§æœç´¢å’Œæ›¿æ¢æ‰€æœ‰ç¡¬ç¼–ç ï¼Œå»ºç«‹ç»Ÿä¸€çš„CSSå˜é‡ç³»ç»Ÿ

## ğŸ“Š æ€§èƒ½ä¼˜åŒ–

### 1. å†…å­˜ç®¡ç†
- ä¸ç¼“å­˜ç¼©ç•¥å›¾ï¼Œé¿å…å†…å­˜æ³„æ¼
- 5ç§’è¶…æ—¶æœºåˆ¶ï¼Œé˜²æ­¢é•¿æ—¶é—´å ç”¨
- é”™è¯¯çŠ¶æ€åŠæ—¶æ¸…ç†

### 2. æ¸²æŸ“ä¼˜åŒ–
- å¼‚æ­¥å¤„ç†ï¼Œä¸é˜»å¡UI
- ç«‹å³æ˜¾ç¤ºéª¨æ¶å±ï¼Œæå‡ç”¨æˆ·ä½“éªŒ
- Canvasä¼˜åŒ–ï¼Œå¿«é€Ÿç”Ÿæˆç¼©ç•¥å›¾

### 3. ä»£ç ä¼˜åŒ–
- æ¶ˆé™¤é‡å¤ä»£ç ï¼Œç»Ÿä¸€ç¼©ç•¥å›¾ç”Ÿæˆæ–¹æ³•
- å»ºç«‹å±‚çº§é…ç½®ï¼Œé¿å…ç¡¬ç¼–ç 
- ç¼“å­˜è®¡ç®—ç»“æœï¼Œé¿å…é‡å¤è®¡ç®—

## ğŸ›ï¸ ç”¨æˆ·é…ç½®æŒ‡å—

### è°ƒæ•´çª—å£å¤§å°
```javascript
// ä¿®æ”¹ windowSizeRatio ä¸­å¯¹åº”å±å¹•ç±»å‹çš„æ¯”ä¾‹
windowSizeRatio: {
  large: { width: 0.4, height: 0.3 }  // è°ƒæ•´å¤§å±å¹•çª—å£æ¯”ä¾‹
}
```

### è°ƒæ•´èƒ¶å›Šå’Œç¼©ç•¥å›¾å°ºå¯¸
```javascript
inputHeightRatio: 0.15,        // å¢å¤§è¾“å…¥æ¡†é«˜åº¦
capsuleRatio: { height: 0.9 }, // å¢å¤§èƒ¶å›Šé«˜åº¦æ¯”ä¾‹  
thumbnailRatio: 0.85           // è°ƒæ•´ç¼©ç•¥å›¾æ¯”ä¾‹
```

### è°ƒæ•´å›¾ç‰‡å¤§å°é™åˆ¶
```javascript
maxImageSizeMB: 5  // å…è®¸æœ€å¤§5MBå›¾ç‰‡
```

## ğŸ”® æœªæ¥æ‰©å±•å»ºè®®

### 1. å¤šæ˜¾ç¤ºå™¨æ”¯æŒ
- æ£€æµ‹ä¸»æ˜¾ç¤ºå™¨å’Œå‰¯æ˜¾ç¤ºå™¨
- æ ¹æ®å½“å‰æ˜¾ç¤ºå™¨è°ƒæ•´çª—å£å°ºå¯¸

### 2. ç”¨æˆ·è‡ªå®šä¹‰é…ç½®ç•Œé¢
- æä¾›å¯è§†åŒ–é…ç½®ç•Œé¢
- å®æ—¶é¢„è§ˆé…ç½®æ•ˆæœ
- é…ç½®å¯¼å…¥å¯¼å‡ºåŠŸèƒ½

### 3. æ›´å¤šå›¾ç‰‡æ ¼å¼æ”¯æŒ
- HEICã€AVIFç­‰ç°ä»£æ ¼å¼
- RAWæ ¼å¼é¢„è§ˆæ”¯æŒ
- åŠ¨å›¾ä¼˜åŒ–å¤„ç†

### 4. æ€§èƒ½ç›‘æ§
- ç¼©ç•¥å›¾ç”Ÿæˆæ€§èƒ½ç»Ÿè®¡
- å†…å­˜ä½¿ç”¨ç›‘æ§
- ç”¨æˆ·ä½“éªŒæŒ‡æ ‡æ”¶é›†

## ğŸ“ æ€»ç»“

æœ¬æ¬¡å¼€å‘æˆåŠŸå®ç°äº†ï¼š

1. **å®Œæ•´çš„å›¾ç‰‡èƒ¶å›Šç³»ç»Ÿ** - æ”¯æŒæ–‡ä»¶è·¯å¾„å’Œå‰ªè´´æ¿å›¾ç‰‡ï¼ŒåŒ…å«ç¼©ç•¥å›¾ç”Ÿæˆã€å¼‚æ­¥åŠ è½½ã€éª¨æ¶å±åŠ¨ç”»ç­‰å®Œæ•´åŠŸèƒ½
2. **å“åº”å¼è®¾è®¡ç³»ç»Ÿ** - ä»ç¡¬ç¼–ç åƒç´ å€¼å®Œå…¨è½¬æ¢ä¸ºåŠ¨æ€è®¡ç®—çš„å±‚çº§é…ç½®ç³»ç»Ÿ
3. **æ€§èƒ½ä¼˜åŒ–** - å¼‚æ­¥å¤„ç†ã€é”™è¯¯å¤„ç†ã€å†…å­˜ç®¡ç†ç­‰å®Œæ•´çš„æ€§èƒ½ä¼˜åŒ–æ–¹æ¡ˆ
4. **ä»£ç è´¨é‡æå‡** - æ¶ˆé™¤é‡å¤ä»£ç ã€ç»Ÿä¸€æ¥å£ã€å®Œæ•´çš„é”™è¯¯å¤„ç†

ç³»ç»Ÿç°åœ¨å®Œå…¨åŸºäºé…ç½®é©±åŠ¨ï¼Œç”¨æˆ·åªéœ€è°ƒæ•´å‡ ä¸ªæ ¸å¿ƒæ¯”ä¾‹å‚æ•°ï¼Œæ‰€æœ‰UIå…ƒç´ éƒ½ä¼šè‡ªåŠ¨é€‚é…ï¼Œå®ç°äº†çœŸæ­£çš„å“åº”å¼è®¾è®¡ã€‚
