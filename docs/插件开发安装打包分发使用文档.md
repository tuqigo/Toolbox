# MiniToolbox æ’ä»¶å¼€å‘æŒ‡å—

## æ¦‚è¿°

MiniToolbox æä¾›äº†å®Œæ•´çš„æ’ä»¶ç”Ÿæ€ç³»ç»Ÿï¼Œæ”¯æŒæ’ä»¶çš„å¼€å‘ã€æ‰“åŒ…ï¼ˆ.mtpkgï¼‰ã€åˆ†å‘ï¼ˆæ³¨å†Œä¸­å¿ƒ/ç¦»çº¿åŒ…ï¼‰ä¸å®‰è£…ï¼ˆå•†åº—/å¼€å‘è€…å·¥å…·ï¼‰ã€‚æœ¬æ–‡æ¡£æ•´åˆäº†å¼€å‘åˆ°å®‰è£…å…¨æµç¨‹è¯´æ˜ã€‚

## å¿«é€Ÿå¼€å§‹

### 1. åˆ›å»ºæ–°æ’ä»¶

ä½¿ç”¨æ’ä»¶ç”Ÿæˆå™¨å¿«é€Ÿåˆ›å»ºæ’ä»¶æ¨¡æ¿ï¼š

```bash
# äº¤äº’å¼åˆ›å»º
node tools/plugin-generator.js create

# æŒ‡å®šå‚æ•°åˆ›å»º
node tools/plugin-generator.js create \
  --id my-plugin \
  --name "æˆ‘çš„æ’ä»¶" \
  --description "è¿™æ˜¯ä¸€ä¸ªç¤ºä¾‹æ’ä»¶" \
  --author "Your Name" \
  --template ui
```

### 2. æ’ä»¶ç»“æ„

```
my-plugin/
â”œâ”€â”€ plugin.json    # æ’ä»¶é…ç½®æ–‡ä»¶ï¼ˆå¿…éœ€ï¼‰
â”œâ”€â”€ index.html     # UIæ’ä»¶çš„ç•Œé¢æ–‡ä»¶
â”œâ”€â”€ script.js      # æ— UIæ’ä»¶çš„é€»è¾‘æ–‡ä»¶
â”œâ”€â”€ icon.png       # æ’ä»¶å›¾æ ‡ï¼ˆå¯é€‰ï¼‰
â””â”€â”€ README.md      # è¯´æ˜æ–‡æ¡£ï¼ˆæ¨èï¼‰
```

## æ’ä»¶é…ç½® (plugin.json)

### åŸºæœ¬é…ç½®

```json
{
  "name": "æˆ‘çš„æ’ä»¶",
  "description": "æ’ä»¶åŠŸèƒ½æè¿°",
  "version": "1.0.0",
  "author": "ä½œè€…åç§°",
  "logo": "ğŸ”§",
  "features": [
    {
      "code": "my-plugin.action",
      "explain": "æ‰§è¡ŒæŸä¸ªæ“ä½œ",
      "cmds": [
        {
          "type": "keyword",
          "value": "mykey"
        }
      ]
    }
  ]
}
```

**æ³¨æ„**ï¼šä¸å†éœ€è¦æ‰‹åŠ¨æŒ‡å®š `id` å­—æ®µï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨ç”Ÿæˆå”¯ä¸€æ ‡è¯†ç¬¦ã€‚

## æ’ä»¶IDç³»ç»Ÿ

MiniToolbox é‡‡ç”¨æ™ºèƒ½çš„ä¸‰å±‚IDç®¡ç†ç³»ç»Ÿï¼Œå®Œå…¨è§£å†³äº†IDå†²çªé—®é¢˜ï¼š

### IDç”Ÿæˆæœºåˆ¶

1. **æœ¬åœ°å¼€å‘é˜¶æ®µ**
   - ä½¿ç”¨æ’ä»¶ç›®å½•åä½œä¸ºIDï¼ˆå¦‚ `json-formatter`ï¼‰
   - ä»…åœ¨æœ¬åœ°ç¯å¢ƒä¸­ä½¿ç”¨ï¼Œå¯èƒ½å­˜åœ¨é‡å¤

2. **æ‰“åŒ…é˜¶æ®µ**
   - ç”Ÿæˆæ ¼å¼ï¼š`ç›®å½•å-å†…å®¹å“ˆå¸Œ`ï¼ˆå¦‚ `json-formatter-a1b2c3d4`ï¼‰
   - åŸºäºæ’ä»¶å†…å®¹ç”Ÿæˆ8ä½å“ˆå¸Œï¼Œç¡®ä¿ç›¸åŒå†…å®¹äº§ç”Ÿç›¸åŒID
   - å†…å®¹å˜åŒ–æ—¶å“ˆå¸Œä¹Ÿä¼šå˜åŒ–ï¼Œè‡ªåŠ¨ç‰ˆæœ¬æ§åˆ¶

3. **å‘å¸ƒé˜¶æ®µ**
   - æ³¨å†Œä¸­å¿ƒåˆ†é…å…¨å±€å”¯ä¸€IDï¼ˆå¦‚ `reg_1234567890_abcdef`ï¼‰
   - ç»å¯¹å”¯ä¸€ï¼Œé¿å…ä»»ä½•å†²çªå¯èƒ½

### å¼€å‘è€…ä¼˜åŠ¿

- âœ… **é›¶é…ç½®**ï¼šæ— éœ€è€ƒè™‘IDå‘½åå’Œå†²çª
- âœ… **è‡ªåŠ¨å”¯ä¸€**ï¼šç³»ç»Ÿä¿è¯åœ¨æ¯ä¸ªé˜¶æ®µçš„å”¯ä¸€æ€§
- âœ… **å†…å®¹æ„ŸçŸ¥**ï¼šç›¸åŒå†…å®¹å§‹ç»ˆç”Ÿæˆç›¸åŒID
- âœ… **å‘åå…¼å®¹**ï¼šç°æœ‰æ’ä»¶è‡ªåŠ¨é€‚é…æ–°ç³»ç»Ÿ

### UIæ’ä»¶é…ç½®

UIæ’ä»¶éœ€è¦æ·»åŠ çª—å£é…ç½®ï¼š

```json
{
  "window": {
    "width": 800,
    "height": 600,
    "resizable": true,
    "minWidth": 600,
    "minHeight": 400
  }
}
```

### å‘½ä»¤åŒ¹é…é…ç½®

æ”¯æŒå¤šç§å‘½ä»¤åŒ¹é…æ–¹å¼ï¼š

```json
{
  "features": [
    {
      "code": "feature.code",
      "explain": "åŠŸèƒ½è¯´æ˜",
      "cmds": [
        {
          "type": "keyword",
          "value": "å…³é”®è¯"
        },
        {
          "type": "regex",
          "match": "/^https?:\\/\\//i"
        },
        {
          "type": "prefix",
          "value": "prefix:"
        }
      ]
    }
  ]
}
```

## æ’ä»¶ç±»å‹

### 1. æ— UIæ’ä»¶ (script.js)

æ— UIæ’ä»¶é€šè¿‡ `script.js` æ–‡ä»¶å®ç°é€»è¾‘ï¼Œé€‚åˆåå°å¤„ç†ä»»åŠ¡ã€‚

```javascript
module.exports = {
  'my-plugin.action': {
    async handleEnter(action, callbackSetList) {
      const { payload, type } = action;
      
      // å¤„ç†é€»è¾‘
      const result = await processData(payload);
      
      // è¿”å›ç»“æœåˆ—è¡¨
      callbackSetList([{
        title: 'å¤„ç†ç»“æœ',
        description: result,
        data: { result }
      }]);
    },

    async handleSelect(action, itemData, callbackSetList) {
      // å¤„ç†ç”¨æˆ·é€‰æ‹©
      if (itemData.data) {
        // å¤åˆ¶ç»“æœåˆ°å‰ªè´´æ¿
        const { clipboard } = require('electron');
        clipboard.writeText(itemData.data.result);
      }
    }
  }
};

async function processData(input) {
  // å®ç°ä½ çš„å¤„ç†é€»è¾‘
  return `å¤„ç†ç»“æœ: ${input}`;
}
```

### 2. UIæ’ä»¶ (index.html)

UIæ’ä»¶æä¾›å›¾å½¢ç•Œé¢ï¼Œé€‚åˆå¤æ‚äº¤äº’ã€‚

```html
<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>æˆ‘çš„æ’ä»¶</title>
  <style>
    /* æ’ä»¶æ ·å¼ */
  </style>
</head>
<body>
  <div id="app">
    <!-- æ’ä»¶ç•Œé¢ -->
  </div>

  <script>
    const api = window.MT;

    // ç›‘å¬æ’ä»¶è¾“å…¥
    window.addEventListener('plugin-input', (event) => {
      const inputData = event.detail;
      console.log('æ”¶åˆ°è¾“å…¥:', inputData);
      // å¤„ç†è¾“å…¥æ•°æ®
    });

    // ä½¿ç”¨æ’ä»¶API
    async function useAPI() {
      // è¯»å–å‰ªè´´æ¿
      const result = await api.invoke('mt.secure-call', {
        channel: 'clipboard.readText'
      });
      
      if (result.ok) {
        console.log('å‰ªè´´æ¿å†…å®¹:', result.data);
      }
    }
  </script>
</body>
</html>
```

## æ’ä»¶API

### å®‰å…¨è°ƒç”¨æ¥å£

é€šè¿‡ `window.MT.invoke(channel, payload)` è°ƒç”¨å—é™ APIï¼š

```javascript
// å‰ªè´´æ¿
await window.MT.invoke('clipboard.readText');
await window.MT.invoke('clipboard.writeText', 'text to copy');

// æ‰“å¼€å¤–éƒ¨é“¾æ¥
await window.MT.invoke('openExternal', 'https://example.com');

// ç½‘ç»œè¯·æ±‚
await window.MT.invoke('net.request', { hostname: 'api.example.com', path: '/data', method: 'GET' });
```

### ä¸»é¢˜æ”¯æŒ

è·å–å½“å‰ä¸»é¢˜ä¿¡æ¯ï¼š

```javascript
const res = await window.MT.invoke('ui.getTheme');
const { theme, effective } = res;
```

## å¼€å‘ä¸æœ¬åœ°è¿è¡Œ

### 1. å¼€å‘é˜¶æ®µ

1. åˆ›å»ºæ’ä»¶ç›®å½•åˆ° `plugins/` ä¸‹ï¼Œæˆ–ä»»æ„æœ¬åœ°ç›®å½•
2. ç¼–å†™æ’ä»¶ä»£ç ï¼ˆ`plugin.json`ã€`index.html`/`script.js`ï¼‰
3. æ‰“å¼€æ’ä»¶â€œå¼€å‘è€…å·¥å…·â€
   - é€‰æ‹© `plugin.json` â†’ æŒ‚è½½è¿è¡Œï¼ˆæ— éœ€å¤åˆ¶/é‡å¯ï¼‰
   - å¯æš‚åœ/å¸è½½å¼€å‘æ€æ’ä»¶
4. éœ€è¦æ—¶ä½¿ç”¨â€œé‡æ–°åŠ è½½æ’ä»¶â€é‡å»ºç´¢å¼•

### 2. éªŒè¯æ’ä»¶

```bash
node tools/plugin-packager.js validate ./plugins/my-plugin
```

### 3. æ‰“åŒ…ä¸åˆ†å‘ï¼ˆ.mtpkgï¼‰

```bash
# æ‰“åŒ…å•ä¸ªæ’ä»¶
node tools/plugin-packager.js pack ./plugins/my-plugin ./dist

# æ‰¹é‡æ‰“åŒ…æ‰€æœ‰æ’ä»¶
node tools/plugin-packager.js pack-all ./plugins ./dist
```

åœ¨â€œå¼€å‘è€…å·¥å…·â€ä¸­ä¹Ÿå¯ä¸€é”®æ‰“åŒ… `.mtpkg`ï¼Œåˆ†å‘ç»™ä»–äººï¼Œä½¿ç”¨â€œä»æ–‡ä»¶å®‰è£…â€å³å¯å®‰è£…ã€‚

### 4. å‘å¸ƒæ’ä»¶ï¼ˆæ³¨å†Œä¸­å¿ƒï¼‰

```bash
# è®¾ç½®APIå¯†é’¥
export PLUGIN_API_KEY="your-api-key"

# å‘å¸ƒæ’ä»¶
node tools/publish-plugin.js publish ./plugins/my-plugin

# æ‰¹é‡å‘å¸ƒ
node tools/publish-plugin.js publish-all ./plugins
```

## æœ€ä½³å®è·µ

### 1. é”™è¯¯å¤„ç†

```javascript
async handleEnter(action, callbackSetList) {
  try {
    const result = await processData(action.payload);
    callbackSetList([{
      title: 'æˆåŠŸ',
      description: result,
      data: { result }
    }]);
  } catch (error) {
    callbackSetList([{
      title: 'å¤„ç†å¤±è´¥',
      description: error.message,
      data: null
    }]);
  }
}
```

### 2. è¾“å…¥éªŒè¯

```javascript
async handleEnter(action, callbackSetList) {
  const { payload, type } = action;
  
  if (!payload || payload.trim().length === 0) {
    callbackSetList([{
      title: 'é”™è¯¯',
      description: 'è¾“å…¥ä¸èƒ½ä¸ºç©º',
      data: null
    }]);
    return;
  }
  
  // ç»§ç»­å¤„ç†...
}
```

### 3. æ€§èƒ½ä¼˜åŒ–

- é¿å…é˜»å¡ä¸»çº¿ç¨‹çš„é•¿æ—¶é—´æ“ä½œ
- ä½¿ç”¨å¼‚æ­¥æ“ä½œå¤„ç†è€—æ—¶ä»»åŠ¡
- åˆç†ä½¿ç”¨ç¼“å­˜å‡å°‘é‡å¤è®¡ç®—

### 4. ç”¨æˆ·ä½“éªŒ

- æä¾›æ¸…æ™°çš„æ“ä½œåé¦ˆ
- æ”¯æŒé”®ç›˜å¿«æ·é”®
- ä¿æŒç•Œé¢ç®€æ´ç›´è§‚

## è°ƒè¯•æŠ€å·§

### 1. æ§åˆ¶å°è¾“å‡º

```javascript
console.log('è°ƒè¯•ä¿¡æ¯:', data);
console.error('é”™è¯¯ä¿¡æ¯:', error);
```

### 2. å¼€å‘è€…å·¥å…·

åœ¨å¼€å‘æ¨¡å¼ä¸‹ï¼Œå¯ä»¥ä¸ºæ’ä»¶çª—å£æ‰“å¼€å¼€å‘è€…å·¥å…·ï¼š

```javascript
// åœ¨æ’ä»¶ä¸­è§¦å‘å¼€å‘è€…å·¥å…·
if (process.env.NODE_ENV === 'development') {
  // è°ƒè¯•ä»£ç 
}
```

### 3. æ—¥å¿—è®°å½•

```javascript
// è®°å½•æ’ä»¶æ“ä½œæ—¥å¿—
const logAction = (action, data) => {
  console.log(`[${new Date().toISOString()}] ${action}:`, data);
};
```

## ç¤ºä¾‹æ’ä»¶

### æ–‡æœ¬å¤„ç†æ’ä»¶

```javascript
module.exports = {
  'text-processor.uppercase': {
    async handleEnter(action, callbackSetList) {
      const { payload } = action;
      const result = payload.toUpperCase();
      
      callbackSetList([{
        title: 'è½¬æ¢ä¸ºå¤§å†™',
        description: result,
        data: { result }
      }]);
    },

    async handleSelect(action, itemData, callbackSetList) {
      if (itemData.data) {
        const { clipboard } = require('electron');
        clipboard.writeText(itemData.data.result);
      }
    }
  }
};
```

### URLå·¥å…·æ’ä»¶

```javascript
module.exports = {
  'url-tool.open': {
    async handleEnter(action, callbackSetList) {
      const { payload } = action;
      
      if (!/^https?:\/\//.test(payload)) {
        callbackSetList([{
          title: 'æ— æ•ˆURL',
          description: 'è¯·è¾“å…¥æœ‰æ•ˆçš„URLåœ°å€',
          data: null
        }]);
        return;
      }
      
      callbackSetList([{
        title: 'æ‰“å¼€é“¾æ¥',
        description: payload,
        data: { url: payload }
      }]);
    },

    async handleSelect(action, itemData, callbackSetList) {
      if (itemData.data && itemData.data.url) {
        const { shell } = require('electron');
        await shell.openExternal(itemData.data.url);
      }
    }
  }
};
```

## å¸¸è§é—®é¢˜

### Q: æ’ä»¶å¦‚ä½•è®¿é—®æœ¬åœ°æ–‡ä»¶ï¼Ÿ

A: å‡ºäºå®‰å…¨è€ƒè™‘ï¼Œæ’ä»¶æ— æ³•ç›´æ¥è®¿é—®æœ¬åœ°æ–‡ä»¶ç³»ç»Ÿã€‚å¦‚éœ€æ–‡ä»¶æ“ä½œï¼Œè¯·é€šè¿‡æ’ä»¶APIæˆ–åœ¨ä¸»è¿›ç¨‹ä¸­å®ç°ç›¸å…³åŠŸèƒ½ã€‚

### Q: å¦‚ä½•å®ç°æ’ä»¶é—´é€šä¿¡ï¼Ÿ

A: å¯ä»¥é€šè¿‡ `redirect` å‡½æ•°é‡å®šå‘åˆ°å…¶ä»–æ’ä»¶ï¼š

```javascript
action.redirect('target-plugin-id', 'input content');
```

### Q: æ’ä»¶å¦‚ä½•æŒä¹…åŒ–æ•°æ®ï¼Ÿ

A: å»ºè®®ä½¿ç”¨ localStorage æˆ–é€šè¿‡æ’ä»¶APIè°ƒç”¨ä¸»è¿›ç¨‹çš„æ•°æ®å­˜å‚¨åŠŸèƒ½ã€‚

### Q: å¦‚ä½•å¤„ç†å¼‚æ­¥æ“ä½œï¼Ÿ

A: ä½¿ç”¨ async/await æˆ– Promise å¤„ç†å¼‚æ­¥æ“ä½œï¼Œç¡®ä¿åœ¨å›è°ƒä¸­è¿”å›ç»“æœã€‚

## æ›´å¤šèµ„æº

- [æ’ä»¶APIå‚è€ƒ](./PLUGIN_API.md)
- [ç¤ºä¾‹æ’ä»¶é›†åˆ](../examples/)
- [å¸¸è§é—®é¢˜è§£ç­”](./FAQ.md)
- [ç¤¾åŒºè®¨è®º](https://github.com/minitoolbox/discussions)

---

å¦‚æœ‰é—®é¢˜æˆ–å»ºè®®ï¼Œæ¬¢è¿åœ¨ GitHub ä¸Šæäº¤ Issue æˆ– Pull Requestï¼
